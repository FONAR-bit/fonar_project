{% extends "dashboard/base.html" %}
{% load humanize %}
{% load formato_monedas %}

{% block content %}
<h2 class="mb-4">PrÃ©stamos Registrados</h2>

<div class="card">
    <div class="card-body">
        <!-- ðŸ”Ž Formulario de filtros -->
        <form method="get" class="row g-3 mb-4">

            <!-- Buscar por usuario -->
            <div class="col-md-3">
                <input type="text" name="usuario" class="form-control"
                       placeholder="Buscar por usuario..." value="{{ request.GET.usuario }}">
            </div>

            <!-- Rango de fechas -->
            <div class="col-md-3">
                <input type="date" name="fecha_inicio" class="form-control"
                       value="{{ request.GET.fecha_inicio }}">
            </div>
            <div class="col-md-3">
                <input type="date" name="fecha_fin" class="form-control"
                       value="{{ request.GET.fecha_fin }}">
            </div>

            <!-- Monto mÃ­nimo -->
            <div class="col-md-2">
                <input type="number" name="monto_min" class="form-control"
                       placeholder="Monto mÃ­n." value="{{ request.GET.monto_min }}">
            </div>

            <!-- Monto mÃ¡ximo -->
            <div class="col-md-2">
                <input type="number" name="monto_max" class="form-control"
                       placeholder="Monto mÃ¡x." value="{{ request.GET.monto_max }}">
            </div>

            <!-- BotÃ³n filtrar -->
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filtrar</button>
            </div>

            <!-- BotÃ³n limpiar -->
            <div class="col-md-2">
                <a href="{% url 'dashboard:prestamos-list' %}" class="btn btn-secondary w-100">Limpiar</a>
            </div>
        </form>

        <!-- ðŸŸ¦ SecciÃ³n: PrÃ©stamos Vigentes -->
        <div class="mb-4">
            <h5>
                <a class="btn btn-outline-primary" data-bs-toggle="collapse" href="#vigentesCollapse" role="button" aria-expanded="true" aria-controls="vigentesCollapse">
                    ðŸ“Œ PrÃ©stamos Vigentes ({{ prestamos_vigentes|length }})
                </a>
            </h5>
            <div class="collapse show" id="vigentesCollapse">
                {% include "dashboard/prestamos/tabla_prestamos.html" with prestamos=prestamos_vigentes %}
            </div>
        </div>

        <!-- âœ… SecciÃ³n: PrÃ©stamos Pagados -->
        <div class="mb-4">
            <h5>
                <a class="btn btn-outline-success" data-bs-toggle="collapse" href="#pagadosCollapse" role="button" aria-expanded="false" aria-controls="pagadosCollapse">
                    âœ… PrÃ©stamos Pagados ({{ prestamos_pagados|length }})
                </a>
            </h5>
            <div class="collapse" id="pagadosCollapse">
                {% include "dashboard/prestamos/tabla_prestamos.html" with prestamos=prestamos_pagados %}
            </div>
        </div>

        <!-- Acciones -->
        <div class="mt-4">
            <a href="{% url 'dashboard:prestamos-create' %}" class="btn btn-success">âž• Registrar PrÃ©stamo</a>
            <a href="{% url 'dashboard:tasas-list' %}" class="btn btn-secondary">ðŸ“Š Ver Tasas de InterÃ©s</a>
            <a href="{% url 'dashboard:solicitudes-list' %}" class="btn btn-warning">ðŸ“‘ Ver Solicitudes de CrÃ©dito</a>
        </div>
    </div>
</div>
{% endblock %}
